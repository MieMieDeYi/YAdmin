(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["mine"],{1991:function(e,t,a){},"2ae3":function(e,t,a){"use strict";a("1991")},"3adc":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",{staticClass:"box-card"},[a("el-row",[a("el-col",{attrs:{span:10}},[a("el-form",{ref:"modelForm",attrs:{rules:e.formRules,model:e.modelForm,size:"small","label-width":"70px"}},[a("el-form-item",{attrs:{label:"头像"}},[a("el-row",{attrs:{type:"flex",align:"middle"}},[a("el-col",{attrs:{span:10}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.$api.FILE_UPLOAD,"show-file-list":!1,headers:e.headers,name:"files",data:{type:"avatar"},"on-success":e.handleAvatarSuccess,"on-error":e.handleAvatarError,"before-upload":e.beforeAvatarUpload}},[e.modelForm.avatar?a("el-avatar",{attrs:{size:100,src:e.$tools.buildAvatar(e.modelForm.avatar)}},[a("img",{attrs:{src:"https://cube.elemecdn.com/e/fd/0fc7d20532fdaf769a25683617711png.png"}})]):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})],1)],1),a("el-col",{attrs:{span:12}})],1)],1),a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{staticStyle:{display:"none"},attrs:{disabled:!0},model:{value:e.modelForm.id,callback:function(t){e.$set(e.modelForm,"id",t)},expression:"modelForm.id"}}),a("el-input",{attrs:{disabled:!0},model:{value:e.modelForm.username,callback:function(t){e.$set(e.modelForm,"username",t)},expression:"modelForm.username"}})],1),a("el-form-item",{attrs:{label:"昵称",prop:"nickname"}},[a("el-input",{model:{value:e.modelForm.nickname,callback:function(t){e.$set(e.modelForm,"nickname",t)},expression:"modelForm.nickname"}})],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"性别",prop:"gender"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.modelForm.gender,callback:function(t){e.$set(e.modelForm,"gender",t)},expression:"modelForm.gender"}},e._l(e.genderOps,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"年龄",prop:"age"}},[a("el-input",{model:{value:e.modelForm.age,callback:function(t){e.$set(e.modelForm,"age",e._n(t))},expression:"modelForm.age"}})],1)],1)],1),a("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[a("el-input",{attrs:{type:"email"},model:{value:e.modelForm.email,callback:function(t){e.$set(e.modelForm,"email",t)},expression:"modelForm.email"}})],1),a("el-form-item",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("保存")])],1)],1)],1),a("el-col",{attrs:{span:14}},[a("el-timeline",e._l(e.loginTrack.slice(0,3),(function(t){return a("el-timeline-item",{key:t.id,attrs:{timestamp:t.loginTime,placement:"top"}},[a("el-card",[a("h4",[e._v("在IP "+e._s(t.loginIp)+" 登录")])])],1)})),1)],1)],1),a("el-row",[a("p",{staticStyle:{"font-size":"18px"}},[a("b",[e._v("第三方账号绑定")])]),a("p",[a("b",[e._v("你以下任一方式都可以登录到 YAdmin 平台")])]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.userOpenData,"empty-text":"当前账号没有绑定任何平台"}},[a("el-table-column",{attrs:{prop:"type",label:"平台",width:"100",align:"center"}}),a("el-table-column",{attrs:{prop:"type",label:"账号信息",width:"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[a("img",{staticStyle:{"border-radius":"50%"},attrs:{src:t.row.avatar,alt:"头像",width:"30px",height:"30px"}}),a("span",{staticStyle:{"margin-left":"5px"}},[e._v(e._s(t.row.nickname))])])]}}])}),a("el-table-column",{attrs:{prop:"status",label:"状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.status?a("el-button",{attrs:{type:"success",size:"mini",plain:""}},[e._v("启用中")]):a("el-button",{attrs:{type:"danger",size:"mini",plain:""}},[e._v("禁用中")])]}}])}),a("el-table-column",{attrs:{prop:"createTime",label:"绑定时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("i",{staticClass:"el-icon-time"}),a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(e._f("dateFormat")(t.row.createTime)))])]}}])}),a("el-table-column",{attrs:{prop:"",label:"操作",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",size:"mini",plain:""},on:{click:function(a){return e.unbind(t.row)}}},[e._v("解除绑定")])]}}])})],1),a("div",{staticStyle:{"margin-top":"10px"}},[a("p",[a("b",[e._v("你还可以绑定以下账号")])]),a("div",{staticClass:"open-list",attrs:{type:"flex",justify:"start",gutter:10}},e._l(e.openList,(function(t,r){return a("div",{key:r,on:{click:function(a){return e.bind(t.link)}}},[a("div",[a("i",{class:t.icon,style:t.style,attrs:{title:t.title}})]),a("span",[e._v(e._s(t.name))])])})),0)])],1)],1)],1)},o=[],l=(a("32ea"),a("1bc78"),{name:"Mine",data:function(){return{API:this.$api.USER_INFO,headers:{Authorization:"Bearer "+this.$store.state.token},loginTrack:[],genderOps:[{value:"",label:"请选择性别"},{value:"男",label:"男"},{value:"女",label:"女"}],modelForm:{id:null,username:"",nickname:"",avatar:"",email:"",age:null,gender:""},formRules:{nickname:[{required:!0,message:"用户昵称不可以为空",trigger:"blur"},{min:4,max:10,message:"长度在4-10个字符之间",trigger:"blur"}]},userOpenData:[],openList:[{name:"QQ",icon:"fa fa-qq",title:"点击绑定QQ",link:"/oauth/render/qq",style:{background:"#FE7300"}},{name:"待新增。。。",icon:"fa fa-wechat",link:null,title:"待新增。。。",style:{background:"#46D800"}}]}},methods:{beforeAvatarUpload:function(){},handleAvatarSuccess:function(e,t,a){console.log(e),200==e.code?(this.$notify({title:e.msg,type:"success"}),this.modelForm.avatar=e.data,console.log(this.modelForm.avatar)):this.$notify({title:e.msg,type:"waring"})},handleAvatarError:function(e){this.$notify({title:"上传失败",type:"error"})},onSubmit:function(){var e=this;this.$refs["modelForm"].validate((function(t){if(!t)return!1;e.$axios.post(e.API,e.modelForm).then((function(t){if(200==t.code){var a=e.$store.state.user;a=Object.assign(a,e.modelForm),e.$store.commit("setUser",a)}})).catch((function(e){}))}))},queryUserTrack:function(){var e=this;this.$axios.get(this.$api.USER_TRACK,{size:5},!1).then((function(t){200==t.code&&(e.loginTrack=t.data)})).catch((function(t){e.$notify({title:res.msg,type:"error"})}))},queryUserOpen:function(){var e=this;this.$axios.get(this.$api.USER_OPEN,null,!1).then((function(t){200==t.code&&(e.userOpenData=t.data)})).catch((function(e){}))},receiveMsg:function(e){if(e.origin===this.$api.SERVER_BASE){var t=JSON.parse(e.data);console.log(t),200==t.code?(this.$notify({title:t.msg,type:"success"}),this.queryUserOpen()):this.$notify({title:t.msg,type:"warning"}),window.removeEventListener("message",this.receiveMsg)}},bind:function(e){if(e){e=this.$api.SERVER_BASE+e;var t="width=600,height=500,top=100,left=100,menubar=yes,location=yes,resizable=yes,scrollbars=true,status=true";window.open("".concat(e,"?bind=true&_token=").concat(this.$store.state.token),"_blank",t),window.addEventListener("message",this.receiveMsg)}},unbind:function(e){var t=this;this.$axios.delete(this.$api.USER_OPEN,{id:e.id}).then((function(e){200==e.code&&(t.userOpenData=e.data)})).catch((function(e){}))}},computed:{buildAvatar:function(){return this.$api.SERVER_UPLOAD+this.$tools.buildAvatar(this.modelForm.avatar)}},mounted:function(){var e=this;this.queryUserTrack(),this.queryUserOpen();var t=setInterval((function(){e.$store.state.user&&(clearInterval(t),Object.keys(e.modelForm).forEach((function(t){e.modelForm[t]=e.$store.state.user[t]})))}),50)}}),n=l,i=(a("2ae3"),a("5d22")),s=Object(i["a"])(n,r,o,!1,null,null,null);t["default"]=s.exports},fa66:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",{staticClass:"box-card"},[a("el-row",[a("el-col",{attrs:{span:10}},[a("el-form",{ref:"modelForm",attrs:{rules:e.formRules,model:e.modelForm,size:"small","label-width":"70px"}},[a("el-form-item",{attrs:{label:"原密码",prop:"password"}},[a("el-input",{attrs:{"show-password":""},model:{value:e.modelForm.password,callback:function(t){e.$set(e.modelForm,"password",t)},expression:"modelForm.password"}})],1),a("el-form-item",{attrs:{label:"新密码",prop:"newPwd"}},[a("el-input",{attrs:{"show-password":""},model:{value:e.modelForm.newPwd,callback:function(t){e.$set(e.modelForm,"newPwd",t)},expression:"modelForm.newPwd"}})],1),a("el-form-item",{attrs:{label:"确认密码",prop:"confirmPwd"}},[a("el-input",{attrs:{"show-password":""},model:{value:e.modelForm.confirmPwd,callback:function(t){e.$set(e.modelForm,"confirmPwd",t)},expression:"modelForm.confirmPwd"}})],1),a("el-form-item",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("保存")])],1)],1)],1)],1)],1)],1)},o=[],l={name:"Password",data:function(){var e=this,t=function(t,a,r){var o=/[\w\d]{6,18}/;return o.test(e.modelForm.newPwd)?e.modelForm.newPwd&&e.modelForm.password==e.modelForm.newPwd?r(new Error("原密码和新密码不可以相同")):void r():r(new Error("请输入6-18位的英文和数字密码"))},a=function(t,a,r){if(e.modelForm.newPwd!=e.modelForm.confirmPwd)return r(new Error("两次输入密码不相同"));r()};return{API:this.$api.USER_PASS,modelForm:{id:this.$store.state.user.id,password:null,newPwd:null,confirmPwd:null},formRules:{password:[{min:6,max:18,message:"长度在6-18个字符之间",trigger:"blur"}],newPwd:[{validator:t,trigger:"blur"},{min:6,max:18,message:"长度在6-18个字符之间",trigger:"blur"}],confirmPwd:[{validator:a,trigger:"blur"},{min:6,max:18,message:"长度在6-18个字符之间",trigger:"blur"}]}}},methods:{onSubmit:function(){var e=this;this.$refs["modelForm"].validate((function(t){if(!t)return!1;e.$axios.post(e.API,e.modelForm).then((function(t){200==t.code&&e.$refs["modelForm"].resetFields()})).catch((function(e){}))}))}},computed:{},mounted:function(){}},n=l,i=a("5d22"),s=Object(i["a"])(n,r,o,!1,null,null,null);t["default"]=s.exports}}]);